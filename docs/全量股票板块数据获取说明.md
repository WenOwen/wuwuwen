# 🚀 全量股票板块数据获取系统

## 📋 概述

已经完全重写了板块数据获取脚本，现在可以基于您的 `all_stock_list.csv` 文件获取所有正常交易股票的真实板块信息。

## ✅ 主要特性

### 1. 基于真实股票列表
- ✅ 自动读取 `data/stockcode_list/all_stock_list.csv`
- ✅ 筛选"正常交易"状态的股票
- ✅ 支持5400+只股票的完整处理

### 2. 灵活的处理模式
- 🧪 **快速测试模式**: 100只股票
- 📊 **中等规模模式**: 500只股票  
- 📈 **大规模模式**: 1000只股票
- 🎯 **完整模式**: 所有正常交易股票
- 🔧 **自定义模式**: 用户指定数量

### 3. 强大的容错机制
- 💾 **断点续传**: 中断后可继续之前的工作
- 🔄 **批次保存**: 每50只股票保存一次中间结果
- ♻️ **重试机制**: 网络错误自动重试3次
- ⏱️ **限速保护**: 避免请求过于频繁

### 4. 详细的进度监控
- 📊 **实时进度**: 显示处理进度和成功率
- 📈 **统计信息**: 行业和概念分布统计
- ⏱️ **时间预估**: 显示总耗时
- 📁 **结果汇总**: 自动生成数据摘要

## 🚀 使用方法

### 第一步：运行脚本
```bash
python data_processing/获取板块数据并保存CSV.py
```

### 第二步：选择处理模式
```
请选择数据获取模式:
1. 快速测试模式 (100只股票)
2. 中等规模模式 (500只股票)
3. 大规模模式 (1000只股票)
4. 完整模式 (所有正常交易股票)
5. 自定义数量

请选择 (1-5): 
```

### 第三步：等待处理完成
```
📊 进度: 50/100 (50.0%) - 成功: 47
💾 已保存中间结果: 47 条记录
✅ 股票板块映射已保存: sector_data/股票板块映射表.csv (100行)
📊 数据统计: 95只股票, 28个行业, 156个概念
```

## 📁 输出文件

### 在 `sector_data/` 目录中生成：

**1. 行业板块数据.csv**
- 所有行业板块的实时数据
- 包含涨跌幅、主力净流入、成交额等

**2. 概念板块数据.csv**
- 所有概念板块的实时数据
- 包含涨跌幅、资金流向、市值等

**3. 热门概念排行.csv**
- 前50个热门概念板块
- 实时热度排名和资金流向

**4. 股票板块映射表.csv**
- 完整的股票板块映射关系
- 包含股票名称、行业、概念、地区等信息

**5. 股票板块映射_训练用.csv** ⭐
- **AI训练专用的简化格式**
- 格式：`stock_code,stock_name,industry,primary_concept,all_concepts,region`

**6. 数据摘要.txt**
- 所有文件的统计信息
- 包含行数、列数、文件大小等

## 🔄 断点续传功能

### 中断处理
如果处理过程中被中断（Ctrl+C 或网络问题）：
- ✅ 已处理的数据会保存在临时文件中
- ✅ 重新运行时会询问是否继续之前的工作

### 继续之前的工作
```bash
python data_processing/获取板块数据并保存CSV.py

# 输出:
发现中断的临时文件，是否继续之前的工作？
输入 'c' 继续，或任意键重新开始: c

📊 已处理 150 只股票，继续处理剩余股票...
```

## ⏱️ 处理时间预估

### 不同模式的预估时间：
- **快速测试模式 (100只)**: 约5-10分钟
- **中等规模模式 (500只)**: 约25-50分钟
- **大规模模式 (1000只)**: 约50-100分钟
- **完整模式 (5400只)**: 约4-8小时

*实际时间取决于网络状况和服务器响应速度*

## 📊 数据质量

### 获取的真实数据包括：
- **28+个真实行业分类** (银行、证券、医药生物等)
- **200+个概念板块** (人工智能、新能源、芯片等)  
- **完整的股票信息** (名称、代码、地区、股本等)
- **实时的资金流向** (主力净流入、成交额等)

### 数据来源：
- **东方财富** - 行业和概念分类
- **实时更新** - 保证数据的时效性
- **官方接口** - 确保数据准确性

## 🛠️ 故障排除

### 常见问题

**1. 找不到股票列表文件**
```
❌ 未找到 all_stock_list.csv 文件
```
**解决**: 确保 `data/stockcode_list/all_stock_list.csv` 文件存在

**2. 网络连接问题**
```
⚠️ 股票 sh600000 重试3次后仍失败: 网络连接错误
```
**解决**: 检查网络连接，脚本会自动跳过失败的股票

**3. 处理中断**
```
⏹️ 用户中断操作
💾 中间结果已保存，可以继续运行来完成剩余工作
```
**解决**: 重新运行脚本，选择继续之前的工作

### 调试模式
如果遇到问题，可以修改日志级别：
```python
logging.basicConfig(level=logging.DEBUG)  # 显示更多调试信息
```

## 🎯 推荐使用流程

### 第一次使用（测试）
1. 选择 **快速测试模式** (100只股票)
2. 验证数据获取正常工作
3. 检查生成的文件格式和内容

### 正式使用（生产）
1. 选择 **完整模式** 获取所有股票数据
2. 耐心等待处理完成（可能需要几小时）
3. 定期（每周）重新获取更新数据

### 增量更新
1. 保留之前的完整数据作为备份
2. 运行新的完整获取
3. 对比新旧数据的差异

## 📈 使用建议

### 最佳实践
- ✅ 首次使用先选择测试模式验证功能
- ✅ 完整模式建议在网络稳定时运行
- ✅ 可以在服务器上后台运行避免中断
- ✅ 建议每周更新一次板块数据

### 服务器后台运行
```bash
# 使用 nohup 后台运行
nohup python data_processing/获取板块数据并保存CSV.py > sector_log.txt 2>&1 &

# 查看运行状态
tail -f sector_log.txt
```

## 🎉 完成后的下一步

### 1. 验证数据
```bash
# 查看生成的文件
ls -la sector_data/

# 查看数据摘要
cat sector_data/数据摘要.txt

# 检查训练用文件
head sector_data/股票板块映射_训练用.csv
```

### 2. 开始AI训练
```bash
# 现在可以使用真实板块数据进行训练
python core/training_pipeline.py

# 系统会自动发现并使用真实板块数据
✅ 发现真实板块数据: sector_data/股票板块映射_训练用.csv
📊 真实映射统计: 4500只股票, 28个行业, 200个概念
```

### 3. 监控数据质量
- 检查成功率是否满足需求（建议>80%）
- 验证重要股票的板块信息是否正确
- 定期更新数据保持时效性

---

**更新时间**: 2025-08-06  
**状态**: 可直接使用  
**数据来源**: 东方财富 + all_stock_list.csv  
**处理能力**: 5400+只股票